cmake_minimum_required(VERSION 3.21.0)
IF (NOT DEFINED CMAKE_INSTALL_PREFIX)
  SET (CMAKE_INSTALL_PREFIX "${CMAKE_BINARY_DIR}/install" CACHE PATH "Mariana Installation Directory")
ENDIF()
if(NOT DEFINED MARIANA_VERSION_MAJOR)
  set(MARIANA_VERSION_MAJOR 0)
endif()
if(NOT DEFINED MARIANA_VERSION_MINOR)
  set(MARIANA_VERSION_MINOR 0)
endif()
if(NOT DEFINED MARIANA_VERSION_PATCH)
  set(MARIANA_VERSION_PATCH 1)
endif()
if(NOT DEFINED MARIANA_VERSION_BUILD)
  set(MARIANA_VERSION_BUILD 5)
endif()

project(Mariana VERSION ${MARIANA_VERSION_MAJOR}.${MARIANA_VERSION_MINOR}.${MARIANA_VERSION_PATCH}.${MARIANA_VERSION_BUILD} LANGUAGES C CXX CUDA)
set(MARIANA_TARGET_VERSION ${CMAKE_PROJECT_VERSION} CACHE STRING "Mariana logical version")
set(MARIANA_TARGET_SOVERSION ${CMAKE_PROJECT_VERSION} CACHE STRING "Mariana soname version")
set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_EXTENSIONS OFF)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
include(cmake/git.cmake)
include(cmake/instruction.cmake)
configure_file(version.hpp.in generated/version.hpp @ONLY)
configure_file(config.hpp.in generated/config.hpp @ONLY)

message(STATUS "Build info Git hash:${GIT_HASH} Version:${MARIANA_TARGET_VERSION}")

include(GNUInstallDirs)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR})
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR})
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_BINDIR})

add_subdirectory(core)

add_library(${CMAKE_PROJECT_NAME}-static STATIC)
add_library(${CMAKE_PROJECT_NAME} SHARED)
target_link_libraries(${CMAKE_PROJECT_NAME}-static PRIVATE mariana_core)
target_link_libraries(${CMAKE_PROJECT_NAME} PRIVATE mariana_core)

set_target_properties(${CMAKE_PROJECT_NAME}-static PROPERTIES VERSION ${MARIANA_TARGET_VERSION} SOVERSION ${MARIANA_TARGET_SOVERSION})
set_target_properties(${CMAKE_PROJECT_NAME} PROPERTIES VERSION ${MARIANA_TARGET_VERSION} SOVERSION ${MARIANA_TARGET_SOVERSION})

set_target_properties(${CMAKE_PROJECT_NAME}-static PROPERTIES OUTPUT_NAME "mariana")
set_target_properties(${CMAKE_PROJECT_NAME} PROPERTIES OUTPUT_NAME "mariana")
